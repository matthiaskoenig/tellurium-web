<div class="panel panel-default">
   <!-- navigate archives -->
    <a href="{{ url('combine:archive_previous', args=[archive.id]) }}"
       title="Previous archive"><span class="btn-xs btn-primary"><i
            class="fa fa-arrow-circle-o-left fa-fw"></i></span></a>
    <a href="{{ url('combine:archive_next', args=[archive.id]) }}"
       title="Next archive"><span class="btn-xs btn-primary"><i
            class="fa fa-arrow-circle-o-right fa-fw"></i></span></a>
    <div class="panel-heading">

        <h2 class="panel-title">
            <i class="fa fa-archive fa-fw"></i>
            <a href="{{ url('combine:archive', args=[archive.id]) }}">
                <span class="label label-primary">{{ archive }}</span></a>
            <a href="{{ url('combine:download_archive', args=[archive.id]) }}" title="Download archive"><i
                    class="fa fa-download fa-fw"></i></a>

            <span class="pull-right">
                <!-- delete archive -->
                {% if request.user.is_authenticated %}
                <a href="{{ url('combine:delete_archive', args=[archive.id]) }}" title="Delete archive {{ archive.id }}: {{ archive.name }}"><span class="btn-xs btn-danger"
                                                                                                              onclick="return confirm('Are you sure you want to delete: {{ archive }}?')">
                    <i class="fa fa-trash fa-fw"></i></span></a>
                {% endif %}
            </span>

        </h2>

    </div>

    <div class="panel-body">
        {% if entries %}
            <table id="entries" class="table table-striped table-condensed table-hover">
                <thead>
                <tr>
                    <th class="hidden hidden-xs"></th>
                    <th>master</th>
                    <th>icon</th>
                    <th>format</th>
                    <th>location</th>
                    <th class="hidden-xs">metadata</th>
                </tr>
                </thead>
                {% for entry in entries %}
                    <tr id="archive_content">
                        <td class="hidden hidden-xs"><span class="badge">{{ loop.index }}</span></td>
                        <td>{% if entry.master %}
                            <i class="fa fa-star fa-fw" title="master"></i>
                        {% endif %}
                        </td>
                        <td>
                            {% if entry.base_format in ['cellml', 'sed-ml', 'sbml', 'numl', 'csv', 'sbgn', 'omex', 'omex-manifest', 'omex-metadata'] %}
                                <img height=20 title="{{ entry.format }}"
                                     src="{{ static('combine/images/mediatype/')}}{{ entry.base_format }}.png">
                            {% endif %}
                        </td>
                        <td>
                            <code title="{{ entry.format }}">{{ entry.short_format }}</code>
                        </td>
                        <td class="location">
                            {% if entry.location in ['.', './manifest.xml'] %}
                                {{ entry.location }}
                            {% else %}
                                <a href="{{ url('combine:archive_entry', args=[archive.id, loop.index0]) }}"
                                   target="_blank">{{ entry.location }}</a>
                            {% endif %}
                        </td>

                        <td class="hidden-xs">
                            {% if entry.metadata %}
                                {% with md = entry.metadata %}

                                    <span data-toggle="popover"
                                          data-html="true"
                                          class="btn-xs btn-default"
                                          title="{% for creator in md.creators %}
                                                <b>{{ creator.givenName }} {{ creator.familyName }}</b>
                                                {% if creator.organisation %}
                                                ({{ creator.organisation }})
                                                {% endif %}<br/>
                                               {% endfor %}"
                                          data-content="{% if md.created %}
                                                        <b>created</b><br />
                                                        <code>{{ md.created }}</code><br />
                                                     {% endif %}
                                                     {% if md.modified %}
                                                     <b>modified</b><br />
                                                     {% endif %}
                                                        {% for mod in md.modified %}
                                                            <code>{{ mod }}</code><br/>
                                                        {% endfor %}"> <i class="fa fa-plus-square-o fa-fw"
                                                                          title="metadata"></i></span>
                                {% endwith %}
                            {% endif %}

                            {% if entry.metadata %}
                                {% with md = entry.metadata %}
                                    {{ md.description }}
                                {% endwith %}
                            {% endif %}
                        </td>

                    </tr>
                {% endfor %}
            </table>
        {% else %}
            <p>No entries in archive metadata.</p>
        {% endif %}

        <span class="label label-primary" title="ZIP Content">zip content</span>

        <div class="row">
            <div class="col-sm-6"id="json_tree"></div>
            <div class="col-sm-6">
                <div id="title_div">
                    <h3 id="title"></h3>
                </div>
                <div id="item_detail">
                </div>
            </div>

        </div>


        <script>
            var endpoint = './zip_tree';

        $.ajax({
            method: "GET",
            url: endpoint,
            success: function (data) {
                $('#json_tree').jstree({
                    'core': {
                        'multiple': false,
                        'data': data
                    }

                });
            },
            error: function (error_data) {
                console.log("error");
                console.log(error_data);

            }
        })
        </script>

        <script>
            $("tr#archive_content").click(function(e){     //function_td
                var $row = $(this).closest("tr");    // Find the row
                var $text = $row.find(".location").text(); // Find the text

                // Let's test it out
                var div = document.getElementById('item_detail');
                div.innerHTML = $text;
            });
        </script>

        <script>
             $('#json_tree')
              // listen for event
              .on('changed.jstree', function (e, data) {
                  $("#item_detail").empty();
                  $("#title").empty();

                var i, j, r = [];
                for(i = 0, j = data.selected.length; i < j; i++) {
                  r.push(data.instance.get_node(data.selected[i]).id);
                }
                var entry_detail = get_detail(r.join(', '));
                if(typeof entry_detail !== 'undefined' ){
                    $("#title").text(" "+entry_detail.location);
                    add_master_icon(entry_detail);
                    add_format_icon(entry_detail);
                  }


                for (var key in entry_detail) {
                    addItem(key, entry_detail[key]);

                    }});

             function add_master_icon(entry_detail) {
                 if(entry_detail.master){
                 $("#title").append(' '+'<i class="fa fa-star fa-fw" title="master"></i>')
             }}

             function add_format_icon (entry_detail){
                 format_list = ['cellml', 'sed-ml', 'sbml', 'numl', 'csv', 'sbgn', 'omex', 'omex-manifest', 'omex-metadata'];
                 if(typeof entry_detail.base_format !== 'undefined' && format_list.indexOf(entry_detail.base_format)>=0){
                 var src="{{static('combine/images/mediatype/')}}"+entry_detail.base_format+".png";
                 $('#title').prepend($('<img>', {
                        src : src,
                        height : 20,
                        title : entry_detail.format
                    }));}
             }

            function addItem(key, value) {

                $("#item_detail").append('<dl><dt>' + key + '</dt><dd>' + value + '</dd></dl>');
            }


            function get_detail(location) {
                 var i, j, r = [];
                 var entries = {{entries_json|safe}};
                 for( i = 0; i < entries.length; i++) {
                     if (entries[i].location == location){
                         return entries[i]
                     }
                 }


            }

        </script>


        <script>
            var endpoint = './0';
            var text, parser, xmlDoc;


        $.ajax({
            method: "GET",
            url: endpoint,
            success: function (data) {
                parser = new DOMParser();
                xmlDoc = parser.parseFromString(data,"text/xml");
                console.log(xmlDoc.getElementsByTagName("rdf:Description")[1]);

            },
            error: function (error_data) {
                console.log("error");
                console.log(error_data);

            }
        })
        </script>








    </div>
</div>
