{% import 'combine/macros.html' as macros %}
    <div class="panel panel-default">

        <div class="panel-heading">
            <h2 class="panel-title">
                <i class="fa fa-industry fa-fw"></i> Task
            </h2>
        </div>

        <div class="panel-body">

            <!-- status -->
            {% if task %}
                {{ macros.task_status(task) }}
            {% else %}
                <span class="label label-default">None</span> Archive has not been executed.
            {% endif %}

            <!-- task id -->
            {% if archive.task_id %}
                {{ archive.task_id }}
            {% endif %}

            <!-- task result -->
                {% if task_result %}
                    <a href="{{ url('combine:taskresult', args=[task_result.pk]) }}">
                        <span class="label label-default">TaskResult</span>
                    </a>
                {% endif %}

                <br /><br/>

                <!-- results -->
                {% if task.status == 'SUCCESS' %}
                    <a href="{{ url('combine:results', args=[archive.id]) }}" title="View the outputs (plots & reports)">
                        <span class="btn btn-primary"><i class="fa fa-line-chart fa-fw"></i> RESULTS</span></a>
                {% endif %}

                <!-- traceback -->
                {% if task_result %}
                    {%  if task_result.traceback %}
                    <pre>
                    <code>{{ task_result.traceback|safe }}</code>
                    </pre>
                    {% endif %}
                {% endif %}

                <!-- run archive action -->
                <a href="{{ url('combine:run_archive', args=[archive.id]) }}">
                {% if task %}
                    {% if task.status == 'SUCCESS' %}
                        <span class="btn btn-default">
                             <i class="fa fa-forward fa-fw" title="RERUN"></i> RERUN</span></a>
                    {% elif task.status == 'FAILURE' %}
                        <span class="btn btn-danger">
                             <i class="fa fa-refresh fa-fw" title="RETRY"></i> RETRY</span></a>
                    {% else %}
                        <span class="btn btn-info">
                             <i class="fa fa-cog fa-spin fa-fw" title="EXECUTING"></i> EXECUTING</span></a>
                        <a href="{{ url('combine:archive', args=[archive.id]) }}">
                             <span class="btn btn-default">
                                 <i class="fa fa-refresh fa-fw" title="CHECK STATUS"></i> CHECK TASK STATUS</span></a>
                    {% endif %}
                {% else %}
                    <span class="btn btn-success">
                         <i class="fa fa-play-circle fa-fw" title="RUN"></i> RUN</span></a>
                {% endif %}

        </div>
    </div>