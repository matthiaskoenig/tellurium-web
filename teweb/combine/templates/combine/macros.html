<!--
Definition of reusable macro function in templates
-->

<!-- Tags -->
{% macro tag_html(tag) %}
<a href="{{ url('combine:tag', args=[tag.id]) }}"><span class="btn btn-default btn-xs" title="Show tag details"><i class="fas fa-fw fa-tag"></i> {{ tag.category }}:<b>{{ tag.name }}</b></span></a>
{% endmacro %}


<!-- Archives -->
{% macro archive_html(archive) %}
    <a href="{{ url('combine:archive', args=[archive.id]) }}"><span class="btn btn-xs btn-primary" title="Show archive details">
        <i class="fas fa-archive fa-fw"></i> {{ archive.name }}</span></a>
{% endmacro %}

{% macro archive_download(archive) %}
<a href="{{ url('combine:download_archive', args=[archive.id]) }}" title="Download archive">
                <button class="btn-xs btn-default"><i class="fas fa-download fa-fw"></i></button></a>
{% endmacro %}

{% macro archive_delete(archive) %}
    <a href="{{ url('combine:delete_archive', args=[archive.id]) }}" title="Delete archive {{ archive.id }}: {{ archive.name }}"><span class="btn-xs btn-danger"
                                                                              onclick="return confirm('Are you sure you want to delete: {{ archive }}?')">
    <i class="fas fa-trash fa-fw"></i></span></a>
{% endmacro %}


<!-- Archive action -->
{%  macro archive_action(archive) %}
    <span class="archive-action" archive="{{ archive.id }}">
{% if archive.task_id %}

    {% with task = archive.task %}
            {% if task %}
                {% if task.status == 'SUCCESS' %}
                    <button id="action_{{ archive.id }}" class="btn-xs btn-default" title="Rerun archive">
                        <i class="fas fa-sync-alt fa-fw"></i></button>
                {% elif task.status == 'FAILURE' %}
                    <button id="action_{{ archive.id }}" class="btn-xs btn-danger" title="Retry archive">
                        <i class="fas fa-sync-alt fa-fw"></i></button>
                {% else %}
                    <button id="action_{{ archive.id }}" class="btn-xs btn-info" title="Executing archive">
                        <i class="fas fa-cog fa-spin fa-fw"></i></button>
                {% endif %}
            {% endif %}
    {% endwith %}
{% else %}
    {% if archive.has_sedml() %}
    <button id="action_{{ archive.id }}" class="btn-xs btn-success" title="Run archive">
        <i class="fas fa-play-circle fa-fw"></i></button>
    {% endif %}

{% endif %}
{% endmacro %}

<!-- Archive results -->
{% macro archive_results(archive) %}
{% if archive.task_id %}
    {% with task = archive.task %}
        {% if task.status == "SUCCESS" %}
            <a href="{{ url('combine:results', args=[archive.id])}}"><button id="results_{{ archive.id }}" class="btn-xs btn-default" title="Show results">
            <i class="fas fa-chart-line fa-fw fa-lg"></i>
            </button></a>
        {% endif %}
    {% endwith %}
{% endif %}
{% endmacro %}

<!-- User -->
{% macro user(user) %}
{% if user %}
    {% if user.username == "global" %}
        <i class="fas fa-fw fa-globe" title="global"></i>
    {% else %}
        <i class="fas fa-fw fa-user"></i> {{ user }}
    {%  endif %}
{% else %}
<i class="fas fa-fw fa-ban"></i>
{% endif %}
{% endmacro %}

<!-- Status -->
{%  macro archive_status(archive) %}
{% if archive.task_id %}
    {{ task_status(archive.task) }}
{% endif %}
{% endmacro %}

{% macro task_status(task) %}
    {% if task.status == "SUCCESS" %}
        <span class="label label-success"><i
                class="fas fa-check-square fa-fw"></i> {{ task.status }}</span>
    {% elif task.status == "FAILURE" %}
        <span class="label label-danger"><i
                class="fas fa-minus-square fa-fw"></i> {{ task.status }}</span>
    {% else %}
        <span class="label label-info"
              title="{{ task }}">{{ task.status }}</span>
    {% endif %}
{% endmacro %}
